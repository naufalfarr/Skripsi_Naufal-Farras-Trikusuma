#include <ESP8266WiFi.h>
#include <espnow.h>
#include <Crypto.h>
#include <AES.h>
#include <cstring>
#include <stdint.h>
#include <chrono>

using namespace std::chrono;

const size_t BLOCK_SIZE = 16;
const unsigned long TIMEOUT_MS = 100;

// 256-bit AES Key (32 bytes)
uint8_t key[32] = {
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
    0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
    0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
    0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F
};

// PKCS7 Padding
void applyPadding(uint8_t *data, size_t len, size_t paddedLen) {
    uint8_t padValue = paddedLen - len;
    for (size_t i = len; i < paddedLen; ++i) {
        data[i] = padValue;
    }
}

// AES-256 ECB Encryption
void aes256Encrypt(const uint8_t *input, uint8_t *output, size_t len, const uint8_t key[32]) {
    AES aes;
    aes.set_key(key, 32);
    for (size_t i = 0; i < len; i += BLOCK_SIZE) {
        aes.encrypt(input + i, output + i);
    }
}

// Function to send data in chunks via ESP-NOW
void sendLargeData(uint8_t *data, size_t len) {
    for (size_t i = 0; i < len; i += 250) {
        size_t chunkSize = min((size_t)250, len - i);
        esp_now_send(nullptr, data + i, chunkSize); // Cast to u8*
        delay(10); // Short delay to avoid overwhelming the receiver
    }
}

// Function to encrypt and send data
void encryptAndSendData() {
 const char *plaintext =
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.50,71.00"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.90"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.80"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,70.70"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.60,72.20"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.80,73.80"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,72.10"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.90"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.70"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.40,71.50"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.40"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.30"
      "30.50,71.3"
      "30.50,71.1"
      "30.50,71.1"
      "30.50,71.10"
      "30.50,71.1"
      "30.50,71.10"
      "30.50,71.1"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.1"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "30.50,71.10"
      "dataEnd";  // Ensure to terminate your data

      
    size_t messageLen = strlen(plaintext);
    Serial.print("Original Data Size: ");
    Serial.println(messageLen);
    
    // Calculate padded length
    size_t paddedLen = (messageLen + BLOCK_SIZE - 1) / BLOCK_SIZE * BLOCK_SIZE;

    // Allocate buffer for encrypted data
    uint8_t *encryptedData = (uint8_t*)malloc(paddedLen);
    if (!encryptedData) {
        Serial.println("Failed to allocate encryption buffer");
        return;
    }

    

    // Copy data to buffer and apply padding
    memcpy(encryptedData, plaintext, messageLen);
    applyPadding(encryptedData, messageLen, paddedLen);
    auto start = high_resolution_clock::now();

    // Encrypt data
    aes256Encrypt(encryptedData, encryptedData, paddedLen, key);

    auto end = high_resolution_clock::now();
    auto encryptDuration = duration_cast<microseconds>(end - start).count();  
    Serial.print("Encryption Time Computation: ");
    Serial.print(encryptDuration);
    Serial.println(" microseconds (μs)");
    delay(2000);

    // Send data in chunks
    sendLargeData(encryptedData, paddedLen);

    // Cleanup
    free(encryptedData);
}

void setup() {
    Serial.begin(115200);
    WiFi.mode(WIFI_STA);

    if (esp_now_init() != 0) {
        Serial.println("Error initializing ESP-NOW");
        ESP.restart();
    }

    esp_now_set_self_role(ESP_NOW_ROLE_CONTROLLER);
    
    // Set peer MAC address of the receiver
    uint8_t receiverMac[] = {0x84, 0xF3, 0xEB, 0x05, 0x50, 0xB7};
    esp_now_add_peer(receiverMac, ESP_NOW_ROLE_SLAVE, 1, NULL, 0);
}

void loop() {
    // Example of calling encryption and sending function within loop
    encryptAndSendData();
    delay(2000); // Send data every 2 seconds
    Serial.println("------------------------------------------------");    
}
